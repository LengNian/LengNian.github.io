<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="é­ç¬™è‘­"><meta name="copyright" content="é­ç¬™è‘­"><meta name="generator" content="Hexo 7.3.0"><meta name="theme" content="hexo-theme-yun"><title>å¯¹æŠ—æ”»å‡»:CWç®—æ³• | WeiSJ&amp;HEXO</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script defer src="https://fastly.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script><link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.css"><script defer src="https://fastly.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><script defer src="https://fastly.jsdelivr.net/npm/katex@latest/dist/contrib/auto-render.min.js"></script><script type="module">import { renderKatex } from '/js/utils.js'
document.addEventListener("DOMContentLoaded", () => {
  renderKatex({
    ...{},
    ...undefined?.options,
  });
});</script><link class="aplayer-style-marker" rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/npm/aplayer@latest/dist/APlayer.min.css"><script class="aplayer-script-marker" src="https://fastly.jsdelivr.net/npm/aplayer@latest/dist/APlayer.min.js" defer></script><script class="meting-script-marker" src="https://fastly.jsdelivr.net/npm/meting@1/dist/Meting.min.js" defer></script><link rel="icon" type="image/png" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"lengnian.github.io","root":"/","title":"é­ç¬™è‘­çš„å°çª","version":"1.10.11","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"æœç´¢...","empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹: ${query}","hits":"æ‰¾åˆ° ${hits} æ¡ç»“æœ","hits_time":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><link rel="alternate" href="/atom.xml" title="WeiSJ&HEXO" type="application/atom+xml"><meta name="description" content="å‰è¨€CWåŸç†CWæ˜¯ä¸€ç§åŸºäºä¼˜åŒ–çš„æ”»å‡»ï¼Œå®ƒåŒæ—¶å…¼é¡¾é«˜æ”»å‡»å‡†ç¡®ç‡å’Œä½å¯¹æŠ—æ‰°åŠ¨ä¸¤ä¸ªæ–¹é¢ã€‚åœ¨è®ºæ–‡1608.04644 (arxiv.org)ä¸­è¢«æå‡ºã€‚ åœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­éœ€è¦å®Œæˆä¸¤ä¸ªç›®æ ‡ï¼Œä¸€æ˜¯å¯¹æŠ—æ ·æœ¬å’Œå¯¹åº”çš„å¹²å‡€æ ·æœ¬çš„å·®è·åº”è¯¥è¶Šå°è¶Šå¥½ï¼›äºŒæ˜¯å¯¹æŠ—æ ·æœ¬åº”è¯¥ä½¿å¾—æ¨¡å‹åˆ†ç±»é”™ï¼Œä¸”é”™çš„é‚£ä¸€ç±»çš„æ¦‚ç‡è¶Šé«˜è¶Šå¥½ã€‚ æœ€åˆï¼ŒCWæ”»å‡»ä¾èµ–äºå¯¹æŠ—æ€§å®ä¾‹çš„åˆå§‹è¡¨è¿°ï¼š  $$ minimize \quad D(x,x+\delta) \\">
<meta property="og:type" content="article">
<meta property="og:title" content="å¯¹æŠ—æ”»å‡»:CWç®—æ³•">
<meta property="og:url" content="http://lengnian.github.io/posts/ffb6a1cc/index.html">
<meta property="og:site_name" content="WeiSJ&amp;HEXO">
<meta property="og:description" content="å‰è¨€CWåŸç†CWæ˜¯ä¸€ç§åŸºäºä¼˜åŒ–çš„æ”»å‡»ï¼Œå®ƒåŒæ—¶å…¼é¡¾é«˜æ”»å‡»å‡†ç¡®ç‡å’Œä½å¯¹æŠ—æ‰°åŠ¨ä¸¤ä¸ªæ–¹é¢ã€‚åœ¨è®ºæ–‡1608.04644 (arxiv.org)ä¸­è¢«æå‡ºã€‚ åœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­éœ€è¦å®Œæˆä¸¤ä¸ªç›®æ ‡ï¼Œä¸€æ˜¯å¯¹æŠ—æ ·æœ¬å’Œå¯¹åº”çš„å¹²å‡€æ ·æœ¬çš„å·®è·åº”è¯¥è¶Šå°è¶Šå¥½ï¼›äºŒæ˜¯å¯¹æŠ—æ ·æœ¬åº”è¯¥ä½¿å¾—æ¨¡å‹åˆ†ç±»é”™ï¼Œä¸”é”™çš„é‚£ä¸€ç±»çš„æ¦‚ç‡è¶Šé«˜è¶Šå¥½ã€‚ æœ€åˆï¼ŒCWæ”»å‡»ä¾èµ–äºå¯¹æŠ—æ€§å®ä¾‹çš„åˆå§‹è¡¨è¿°ï¼š  $$ minimize \quad D(x,x+\delta) \\">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://lengnian.github.io/posts/ffb6a1cc/1.png">
<meta property="og:image" content="http://lengnian.github.io/posts/ffb6a1cc/2.png">
<meta property="og:image" content="http://lengnian.github.io/posts/ffb6a1cc/3.png">
<meta property="article:published_time" content="2024-07-30T12:33:53.000Z">
<meta property="article:modified_time" content="2024-08-02T08:30:43.647Z">
<meta property="article:author" content="é­ç¬™è‘­">
<meta property="article:tag" content="å¯¹æŠ—æ ·æœ¬ç”Ÿæˆä¸é˜²å¾¡">
<meta property="article:tag" content="å¯¹æŠ—æ”»å‡»">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://lengnian.github.io/posts/ffb6a1cc/1.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="æ–‡ç« ç›®å½•"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="ç«™ç‚¹æ¦‚è§ˆ"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="é­ç¬™è‘­"><img width="96" loading="lazy" src="/images/avatar1.png" alt="é­ç¬™è‘­"><span class="site-author-status" title="ä¸æƒ³ç§‘ç ”">ğŸ˜­</span></a><div class="site-author-name"><a href="/about/">é­ç¬™è‘­</a></div><span class="site-name">WeiSJ&HEXO</span><sub class="site-subtitle">äº«å—ç‹¬å¤„</sub><div class="site-description">æ…¢çƒ­ä¸”é•¿æƒ…</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="é¦–é¡µ"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="å½’æ¡£"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">30</span></a></div><div class="site-state-item"><a href="/categories/" title="åˆ†ç±»"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">13</span></a></div><div class="site-state-item"><a href="/tags/" title="æ ‡ç­¾"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">22</span></a></div><a class="site-state-item hty-icon-button" href="/guestbook/" title="ç•™è¨€æ¿"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:message-2-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/LengNian" title="GitHub" target="_blank" style="color:#6E5494"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.mit.edu/" title="School" target="_blank" style="color:#7E2222"><span class="icon iconify" data-icon="ri:school-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:1031477927@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><span class="icon iconify" data-icon="ri:mail-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=1544549234" title="ç½‘æ˜“äº‘éŸ³ä¹" target="_blank" style="color:#C10D0C"><span class="icon iconify" data-icon="ri:netease-cloud-music-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="çŸ¥ä¹" target="_blank" style="color:#0084FF"><span class="icon iconify" data-icon="ri:zhihu-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="å“”å“©å“”å“©" target="_blank" style="color:#FF8EB3"><span class="icon iconify" data-icon="ri:bilibili-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><span class="icon iconify" data-icon="ri:rss-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://travellings.link" title="Travelling" target="_blank" style="color:var(--hty-text-color)"><span class="icon iconify" data-icon="ri:train-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="QQ" target="_blank" style="color:#12B7F5"><span class="icon iconify" data-icon="ri:qq-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="å¾®ä¿¡å…¬ä¼—å·" target="_blank" style="color:#1AAD19"><span class="icon iconify" data-icon="ri:wechat-2-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="Twitter" target="_blank" style="color:#1da1f2"><span class="icon iconify" data-icon="ri:twitter-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="Telegram Channel" target="_blank" style="color:#0088CC"><span class="icon iconify" data-icon="ri:telegram-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="æˆ‘çš„å°ä¼™ä¼´ä»¬" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a><a class="links-item hty-icon-button" href="/girls/" title="æˆ‘çš„å°å¤©ä½¿ä»¬" style="color:#FF0505"><span class="icon iconify" data-icon="ri:hearts-fill"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CW%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">CWåŸç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pytorch%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.</span> <span class="toc-text">Pytorchå®ç°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%AD%E7%BB%83-%E6%94%BB%E5%87%BB%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">4.</span> <span class="toc-text">è®­ç»ƒ+æ”»å‡»å®Œæ•´ä»£ç </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="toc-number">5.</span> <span class="toc-text">å‚è€ƒæ–‡çŒ®</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="http://LengNian.github.io/posts/ffb6a1cc/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="é­ç¬™è‘­"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="WeiSJ&amp;HEXO"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">å¯¹æŠ—æ”»å‡»:CWç®—æ³•</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="åˆ›å»ºæ—¶é—´ï¼š2024-07-30 20:33:53" itemprop="dateCreated datePublished" datetime="2024-07-30T20:33:53+08:00">2024-07-30</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-08-02 16:30:43" itemprop="dateModified" datetime="2024-08-02T16:30:43+08:00">2024-08-02</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="æœ¬æ–‡å­—æ•°"><span class="icon iconify" data-icon="ri:file-word-line"></span></span> <span title="æœ¬æ–‡å­—æ•°">3.5k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="é˜…è¯»æ—¶é•¿"><span class="icon iconify" data-icon="ri:timer-line"></span></span> <span title="é˜…è¯»æ—¶é•¿">17m</span></span></span><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="é˜…è¯»æ¬¡æ•°"><span class="icon iconify" data-icon="ri:eye-line"></span> <span id="busuanzi_value_page_pv"></span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E5%86%99%E6%96%87%E7%AB%A0/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">å†™æ–‡ç« </span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/%E5%AF%B9%E6%8A%97%E6%A0%B7%E6%9C%AC%E7%94%9F%E6%88%90%E4%B8%8E%E9%98%B2%E5%BE%A1/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">å¯¹æŠ—æ ·æœ¬ç”Ÿæˆä¸é˜²å¾¡</span></a><a class="tag-item" href="/tags/%E5%AF%B9%E6%8A%97%E6%94%BB%E5%87%BB/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">å¯¹æŠ—æ”»å‡»</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><h4 id="CWåŸç†"><a href="#CWåŸç†" class="headerlink" title="CWåŸç†"></a>CWåŸç†</h4><p>CWæ˜¯ä¸€ç§åŸºäºä¼˜åŒ–çš„æ”»å‡»ï¼Œå®ƒåŒæ—¶å…¼é¡¾é«˜æ”»å‡»å‡†ç¡®ç‡å’Œä½å¯¹æŠ—æ‰°åŠ¨ä¸¤ä¸ªæ–¹é¢ã€‚åœ¨è®ºæ–‡<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1608.04644">1608.04644 (arxiv.org)</a>ä¸­è¢«æå‡ºã€‚</p>
<p>åœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­éœ€è¦å®Œæˆä¸¤ä¸ªç›®æ ‡ï¼Œä¸€æ˜¯å¯¹æŠ—æ ·æœ¬å’Œå¯¹åº”çš„å¹²å‡€æ ·æœ¬çš„å·®è·åº”è¯¥è¶Šå°è¶Šå¥½ï¼›äºŒæ˜¯å¯¹æŠ—æ ·æœ¬åº”è¯¥ä½¿å¾—æ¨¡å‹åˆ†ç±»é”™ï¼Œä¸”é”™çš„é‚£ä¸€ç±»çš„æ¦‚ç‡è¶Šé«˜è¶Šå¥½ã€‚</p>
<p>æœ€åˆï¼ŒCWæ”»å‡»ä¾èµ–äºå¯¹æŠ—æ€§å®ä¾‹çš„åˆå§‹è¡¨è¿°ï¼š</p>
<div>
$$
minimize \quad D(x,x+\delta) \\
such\;that \quad C(x+\delta)=t \\
\qquad x+\delta \in [0,1]^n
\tag{1}
$$
</div>
Dæ˜¯åº¦é‡å¯¹æŠ—æ ·æœ¬å’Œå¹²å‡€æ ·æœ¬çš„åº¦é‡å‡½æ•°ï¼Œå¯ä»¥é€‰æ‹©ä¸åŒçš„èŒƒæ•°è·ç¦»(æœ¬æ–‡ä¸»è¦è®²è§£L2èŒƒæ•°)ã€‚Cè¡¨ç¤ºåˆ†ç±»å™¨ï¼Œtä¸ºæœŸæœ›å¯¹æŠ—æ ·æœ¬è¢«åˆ†ç±»æˆçš„æ ‡ç­¾ã€‚

<p>ä¸Šè¿°å…¬å¼ä¸­çš„C(x+Î´)&#x3D;tæ˜¯éçº¿æ€§çš„ï¼Œç°æœ‰çš„ç®—æ³•éš¾ä»¥è§£å†³ï¼Œæƒ³è¦æ±‚è§£éœ€è¦é€‰æ‹©æ›´é€‚åˆä¼˜åŒ–çš„è¡¨è¾¾å¼ã€‚æ‰€ä»¥è®ºæ–‡ä½œè€…å®šä¹‰äº†ä¸€ç³»åˆ—çš„ç›®æ ‡å‡½æ•°få½“ä¸”ä»…å½“f(x+Î´)â‰¤0æ—¶ï¼ŒC(x+Î´)&#x3D;tã€‚</p>
<p>æ‰€ä»¥ï¼Œä¼˜åŒ–ç›®æ ‡å¯ä»¥ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</p>
<div>
$$
minimize \quad D(x,x+\delta) \\
such\;that \quad f(x+\delta) \leq 0 \\
\qquad x+\delta \in [0,1]^n
\tag{2}
$$
</div>
ç›®æ ‡å‡½æ•°è®ºæ–‡ä¸­åˆ—ä¸¾äº†ä¸ƒç§ï¼Œè¿™é‡Œåªåˆ—ä¸¾éƒ¨åˆ†ï¼š
<div>
$$
f_1(x')=-loss_{F,t}(x')+1 \\
f_2(x')=(\underset{i \neq t}{max}(F(x')_i)-F(x')_t)^+ \\
...... \\
f_6(x')=(\underset{i \neq t}{max}(Z(x')_i)-Z(x')_t)^+ \\
......
\tag{3}
$$
</div>
è®ºæ–‡ä½œè€…é€šè¿‡æ·»åŠ å¸¸é‡æ¥è°ƒæ•´ä¸Šé¢ä¸€äº›å…¬å¼ï¼Œç›®çš„æ˜¯ä¸ºäº†ä½¿å‡½æ•°ç¬¦åˆè®ºæ–‡ä¸­çš„å®šä¹‰ï¼Œæ‰€ä»¥å…¬å¼(2)å°±å¯ä»¥è½¬æ¢æˆä»¥ä¸‹å¯æ±‚è§£çš„æ–°çš„ä¼˜åŒ–å½¢å¼ã€‚
<div>
$$
minimize \quad D(x,x+\delta)+c \; \cdot \; f(x+\delta)  \\
such\;that \quad x+\delta \in [0,1]^n \\
\tag{4}
$$
</div>
ä½¿ç”¨èŒƒæ•°å»å®ä¾‹åŒ–è·ç¦»åº¦é‡å‡½æ•°ï¼Œé—®é¢˜å°±å˜ä¸ºäº†ï¼š
<div>
$$
minimize \parallel \delta \parallel_p + c \; \cdot \; f(x+\delta) \\
such \; that \quad x+\delta \in [0,1]^n 
\tag{5}
$$
</div>
ä¸ºäº†ä¿è¯å¯¹æŠ—æ ·æœ¬æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å›¾åƒï¼Œå¿…é¡»å¯¹æ‰°åŠ¨Î´è¿›è¡Œä¸€ä¸ªçº¦æŸã€‚å¦‚æœä¸è¿›è¡Œçº¦æŸï¼Œå¾ˆå®¹æ˜“è¶…å‡ºèŒƒå›´ï¼Œè®ºæ–‡ä¸­æåˆ°äº†ä¸‰ç§æ–¹æ³•ï¼š

<ul>
<li><p>æ¢¯åº¦æŠ•å½±ä¸‹é™ï¼š</p>
</li>
<li><p>æ¢¯åº¦æˆªæ–­ä¸‹é™ï¼šè¿™ç§æ–¹æ³•æ²¡æœ‰çœŸæ­£æ„ä¹‰ä¸Šçš„æˆªæ–­æ ·æœ¬ï¼Œè€Œæ˜¯ç›´æ¥æŠŠçº¦æŸåŠ å…¥åˆ°äº†ç›®æ ‡å‡½æ•°fä¸­ï¼Œå°†f(x+Î´)ä½¿ç”¨f(min(max(x+Î´,0),1))æ¥ä»£æ›¿ï¼Œä½†æ˜¯è¿™æ ·ä¹Ÿå­˜åœ¨æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ã€‚</p>
</li>
<li><p>å˜é‡å¼•å…¥ï¼šé€šè¿‡å¼•å…¥å˜é‡wä½¿ç”¨x+Î´æ»¡è¶³çº¦æŸï¼Œæ­¤æ—¶å¯¹æŠ—æ ·æœ¬å°±è¡¨ç¤ºä¸ºï¼š</p>
<div>
$$
x_i + \delta_i = \frac{1}{2}(tan(w_i)+1) \tag{6}
$$
</div>
ç”±äºtanhçš„å–å€¼èŒƒå›´ä¸º[-1,1]ï¼Œç»è¿‡è¿™ç§çº¦æŸæ–¹æ³•ï¼Œx+Î´çš„å–å€¼èŒƒå›´å˜æˆäº†[0,1]ï¼Œå¾ˆå¥½çš„æ»¡è¶³äº†ä¸Šè¿°æ‰€æåˆ°çš„è¦æ±‚ã€‚
ä¸‹é¢å°±å¯ä»¥å¼€å§‹è¿›è¡Œæ”»å‡»äº†ï¼Œåœ¨è¿™é‡Œä¸»è¦ä½¿ç”¨L2èŒƒæ•°ã€‚æ­¤æ—¶å…¬å¼å°±å˜ä¸ºäº†ï¼š
<div>
$$
minimize \parallel \frac{1}{2}(tanh(w)+1) - x \parallel_2^2 + \; c \; \cdot \; f(\frac{1}{2}(tanh(w)+1)) \\
f(x')=max(max \{ Z(x')_i:i \neq t \}-Z(x')_t, -k)
\tag{7}
$$
</div>
æ­¤æ—¶ï¼Œä»¤
<div>
$$
R_n=\frac{1}{2}(tanh(w_n)+1) - X_n  \tag{8}
$$
</div>
è¿™é‡Œçš„Rnè¡¨ç¤ºå¹²å‡€æ ·æœ¬å’Œå¯¹æŠ—æ ·æœ¬çš„å·®å€¼ï¼Œè¿™é‡Œå¦‚æœä½¿ç”¨tanhï¼Œxçš„èŒƒå›´å°±æ˜¯[0,1]ã€‚è€ŒåŠ å…¥tanhæ˜ å°„ç©ºé—´åï¼Œå°±æ‰©å¤§åˆ°äº†-infå’Œinfä¹‹é—´ã€‚</li>
</ul>
<p>ç„¶åä¸»è¦è¯´ä¸€ä¸‹ç›®æ ‡å‡½æ•°ï¼Œè¿™é‡Œé€‰çš„æ˜¯ä¸Šè¿°è®ºæ–‡åˆ—å‡ºæ¥çš„ç¬¬å…­ä¸ªã€‚Z(x)ä»£è¡¨çš„å°±æ˜¯è¾“å…¥å›¾åƒè¿˜æœªç»è¿‡softmaxæ¿€æ´»å‡½æ•°çš„å‘é‡ï¼Œè¿™ä¸ªå‘é‡çš„æœ€å¤§å€¼æ‰€å¯¹åº”çš„æ ‡å·å°±æ˜¯å³å°†è¢«é¢„æµ‹çš„ç±»åˆ«ã€‚tæ˜¯å¸Œæœ›ç”Ÿæˆçš„å¯¹æŠ—æ ·æœ¬æ‰€å±äºçš„ç±»åˆ«ã€‚</p>
<p>max{Z(xâ€™)iï¼Œiâ‰ t}è¡¨ç¤ºçš„å°±æ˜¯Z(x)ä¸­é™¤å»tè¿™ä¸ªç±»åˆ«ä»¥å¤–çš„æœ€å¤§å€¼ï¼Œä¹Ÿå°±æ˜¯é™¤å»tç±»åˆ«ä»¥å¤–ï¼Œæœ€å¯èƒ½å°†xåˆ†ç±»çš„é‚£ä¸ªç±»åˆ«çš„å€¼ï¼Œå°†max{Z(x)i,iâ‰ t}-Z(xâ€™)tå°±æ˜¯æŒ‡é™¤å»tç±»åˆ«ä»¥å¤–æœ€æœ‰å¯èƒ½è¢«åˆ†ç±»çš„ç±»åˆ«æ‰€å¯¹åº”çš„åœ¨æœªç»è¿‡softmaxæ¿€æ´»å‡½æ•°å‰çš„å‘é‡çš„æœ€å¤§å€¼å’Œå¯¹åº”tç±»çš„çš„æœ€å¤§å€¼çš„å·®ã€‚å°†è¿™ä¸ªå·®æœ€å°åŒ–ä¹Ÿå°±ä½¿å¯¹æŠ—æ ·æœ¬ç¦»å˜æˆtç±»è¶Šæ¥è¿‘ã€‚</p>
<p>ä»(6)å¯ä»¥çœ‹åˆ°è¿˜æœ‰ä¸€ä¸ªå‚æ•°kï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯ç½®ä¿¡åº¦ã€‚è¿™é‡Œå¯ä»¥ç†è§£ä¸ºkè¶Šå¤§ï¼Œç½®ä¿¡åº¦è¶Šå¤§ã€‚kæ˜¯ä¸€ä¸ªæ¦‚ç‡ï¼Œåœ¨0~1ä¹‹é—´ã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿èµ·ï¼Œå¯¹(6)ä¸­ç¬¬ä¸€è¡Œå…¬å¼ç¼–å·ä¸º(9)ï¼Œç¬¬äºŒè¡Œç¼–å·ä¸º(10)ï¼Œæ­¤æ—¶ï¼š</p>
<div>
$$
minimize \parallel R_n \parallel_2^2 + \; c \; \cdot \; f(\frac{1}{2}(tanh(w)+1)) \tag{9}
$$
</div>
<div>
$$
f(x')=max(max \{ Z(x')_i:i \neq t \}-Z(x')_t, -k)  \tag{10}
$$
</div>
å¦‚æœf(x')çš„å€¼ä¸ºmax{Z(x')i,iâ‰ t}-Z(x')t,é‚£ä¹ˆ(8)ä¸­çš„ç¬¬äºŒé¡¹å°±æ˜¯c*max{Z(x')i,iâ‰ t}-Z(x')tï¼Œåªéœ€è¦ä¸æ–­å‡å°å°±å¯ä»¥ã€‚

<p>ä½†æ˜¯å¦‚æœf(xâ€™)çš„å€¼ä¸º-kï¼Œé‚£ä¹ˆ(8)ä¸­ç¬¬äºŒé¡¹å°±å˜ä¸º-ckã€‚kè¶Šå¤§ï¼Œ-ckå°±è¶Šå°ï¼Œä¼˜åŒ–è¿‡ç¨‹å°±ä¼šæ›´å€¾å‘äº(8)ä¸­çš„ç¬¬ä¸€é¡¹ï¼Œå³å¹³æ–¹è¯¯å·®é‚£é¡¹ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´ç”Ÿæˆçš„å¯¹æŠ—æ ·æœ¬æ›´æ¥è¿‘æˆ‘ä»¬å¸Œæœ›å®ƒå˜æˆçš„é‚£ä¸ªç±»åˆ«ã€‚</p>
<h4 id="Pytorchå®ç°"><a href="#Pytorchå®ç°" class="headerlink" title="Pytorchå®ç°"></a>Pytorchå®ç°</h4><p>è¿™é‡ŒåŒ…å«äº†ç›®æ ‡å‡½æ•°få’Œè®¡ç®—ä¼˜åŒ–ç›®æ ‡ä¸¤éƒ¨åˆ†çš„å†…å®¹ã€‚</p>
<pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">def cw_l2_attack(model, images, labels, targeted&#x3D;False, c&#x3D;8, kappa&#x3D;0, max_iter&#x3D;1000, learning_rate&#x3D;0.01):

    # å®šä¹‰ç›®æ ‡å‡½æ•°f
    def f(x):
        # è®ºæ–‡ä¸­çš„ Z(X) è¾“å‡º batchsize, num_classes
        outputs &#x3D; model(x)
        # å°±æ˜¯ä¸€ä¸ªone-hotç¼–ç ,ç„¶åé¢„æµ‹ç±»åˆ«ä¸º1,å…¶ä½™ä¸º0ï¼Œå…±æœ‰batch_sizeè¡Œï¼Œç„¶åæ¯è¡Œæ ¹æ®labelç½®ä¸º0æˆ–1
        one_hot_labels &#x3D; torch.eye(len(outputs[0])).to(device)[labels]
        # 1-one_hot_labelså°±æ˜¯å­—é¢æ„æ€ï¼ŒåŸæ¥æ˜¯0çš„ï¼Œå°±æ˜¯1-0&#x3D;1ï¼ŒåŸæ¥æ˜¯1çš„å°±æ˜¯1-1&#x3D;0ï¼Œç»è¿‡å¤„ç†åé™¤äº†çœŸå®ç±»åˆ«ä»¥å¤–çš„éƒ½æ˜¯1
        # æ°´å¹³æ–¹å‘æœ€å¤§çš„å–å€¼ï¼Œå¿½ç•¥ç´¢å¼•ã€‚æ„æ€æ˜¯ï¼Œé™¤å»çœŸå®æ ‡ç­¾ï¼Œçœ‹çœ‹æ¯ä¸ª batchsize ä¸­å“ªä¸ªæ ‡ç­¾çš„æ¦‚ç‡æœ€å¤§ï¼Œå–å‡ºæ¦‚ç‡
        # æ¦‚ç‡å€¼, æ ‡å·
        i, _ &#x3D; torch.max((1 - one_hot_labels) * outputs, dim&#x3D;1)
        # é€‰æ‹©çœŸå®æ ‡ç­¾çš„æ¦‚ç‡
        j &#x3D; torch.masked_select(outputs, one_hot_labels.bool())

        # å¦‚æœæœ‰æ”»å‡»ç›®æ ‡ï¼Œè™šå‡æ¦‚ç‡å‡å»çœŸå®æ¦‚ç‡ï¼Œ
        if targeted:
            # å¦‚æœ i - j çš„è®¡ç®—ç»“æœå°äº -kappaï¼Œé‚£ä¹ˆä½¿ç”¨ -kappa ä½œä¸ºç»“æœï¼Œè€Œä¸æ˜¯åŸå§‹å€¼ã€‚
            return torch.clamp(i - j, min&#x3D;-kappa)
        # æ²¡æœ‰æ”»å‡»ç›®æ ‡ï¼Œå°±è®©çœŸå®çš„æ¦‚ç‡å°äºè™šå‡çš„æ¦‚ç‡ï¼Œé€æ­¥é™ä½ï¼Œä¹Ÿå°±æ˜¯æœ€å°åŒ–è¿™ä¸ªæŸå¤±
        else:
            return torch.clamp(j - i, min&#x3D;-kappa)
        

    w &#x3D; torch.zeros_like(images, requires_grad&#x3D;True).to(device)
    optimizer &#x3D; torch.optim.Adam([w], lr&#x3D;learning_rate)
    
    prev &#x3D; 1e10

    for step in range(max_iter):
        a &#x3D; 1 &#x2F; 2 * (nn.Tanh()(w) + 1)
        # æœ€å°åŒ–ç›®æ ‡çš„ä¸¤ä¸ªéƒ¨åˆ†
        # ç¬¬ä¸€ä¸ªç›®æ ‡ï¼Œå¯¹æŠ—æ ·æœ¬ä¸åŸå§‹æ ·æœ¬è¶³å¤Ÿæ¥è¿‘
        loss1 &#x3D; nn.MSELoss(reduction&#x3D;&#39;sum&#39;)(a, images)
        # ç¬¬äºŒä¸ªç›®æ ‡ï¼Œè¯¯å¯¼æ¨¡å‹è¾“å‡º
        loss2 &#x3D; torch.sum(c * f(a))

        cost &#x3D; loss1 + loss2
        optimizer.zero_grad()
        cost.backward()
        optimizer.step()

        if step % (max_iter &#x2F;&#x2F; 10) &#x3D;&#x3D; 0:
            if cost &gt; prev:
                print(&#39;Attack Stopped due to CONVERGENCE....&#39;)
                return a
            prev &#x3D; cost

    attack_images &#x3D; 1 &#x2F; 2 * (nn.Tanh()(w) + 1)

    return attack_images<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="è®­ç»ƒ-æ”»å‡»å®Œæ•´ä»£ç "><a href="#è®­ç»ƒ-æ”»å‡»å®Œæ•´ä»£ç " class="headerlink" title="è®­ç»ƒ+æ”»å‡»å®Œæ•´ä»£ç "></a>è®­ç»ƒ+æ”»å‡»å®Œæ•´ä»£ç </h4><p>è¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·ï¼Œä½¿ç”¨è‡ªå·±åœ¨MNISTæ‰‹å†™æ•°æ®é›†ä¸Šè®­ç»ƒçš„LeNetæ¨¡å‹æ¥æµ‹è¯•CWç®—æ³•äº§ç”Ÿçš„å¯¹æŠ—æ ·æœ¬ã€‚</p>
<pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">import torch
import numpy as np
import torchvision
import random
import copy
from tqdm import tqdm
import torch.nn as nn
from torchvision import datasets, transforms
from torchsummary import summary
import matplotlib.pyplot as plt
import torch.nn.functional as F
from torch.utils.data import DataLoader


# æ­å»ºLeNetæ¨¡å‹
class LeNet(nn.Module):
    def __init__(self):
        super(LeNet, self).__init__()

        # å·ç§¯å±‚
        self.conv &#x3D; nn.Sequential(
            nn.Conv2d(in_channels&#x3D;1, out_channels&#x3D;6, kernel_size&#x3D;5, padding&#x3D;2),
            nn.ReLU(),
            nn.MaxPool2d(kernel_size&#x3D;2, stride&#x3D;2),
            nn.Conv2d(in_channels&#x3D;6, out_channels&#x3D;16, kernel_size&#x3D;5),
            nn.ReLU(),
            nn.MaxPool2d(kernel_size&#x3D;2, stride&#x3D;2)
        )

        # å…¨è¿æ¥å±‚
        self.fc &#x3D; nn.Sequential(
            nn.Linear(in_features&#x3D;16 * 5 * 5, out_features&#x3D;120),
            nn.ReLU(),
            nn.Linear(in_features&#x3D;120, out_features&#x3D;84),
            nn.ReLU(),
            nn.Linear(in_features&#x3D;84, out_features&#x3D;10)
        )

    def forward(self, img):
        img &#x3D; self.conv(img)
        img &#x3D; img.view(img.size(0), -1)
        out &#x3D; self.fc(img)
        # out &#x3D; self.softmax(out)
        
        return out

    
net &#x3D; LeNet()
net &#x3D; net.to(device)

device &#x3D; torch.device(&quot;cuda&quot; if torch.cuda.is_available() else &quot;cpu&quot;)

mean &#x3D; 0.1307
std &#x3D; 0.3801

# å¯¹å›¾åƒå˜æ¢
transform &#x3D; transforms.Compose([
    transforms.ToTensor(),
    transforms.Normalize((mean,), (std,))
]
)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-Python'" data-language="Python'"><code class="language-Python'"># è®­ç»ƒæ•°æ®é›†, æµ‹è¯•æ•°æ®é›†
train_dataset &#x3D; datasets.MNIST(&#39;..&#x2F;datasets&#x2F;MNIST&#39;, train&#x3D;True, transform&#x3D;transform, download&#x3D;True) # len 60000
test_dataset &#x3D; datasets.MNIST(&#39;..&#x2F;datasets&#x2F;MNIST&#39;, train&#x3D;False, transform&#x3D;transform, download&#x3D;True) # len 10000

# æ•°æ®è¿­ä»£å™¨
train_dataloader &#x3D; DataLoader(train_dataset, batch_size&#x3D;64, shuffle&#x3D;True)  # len 938
test_dataloader &#x3D; DataLoader(test_dataset, batch_size&#x3D;64, shuffle&#x3D;True) # len 157

lr &#x3D; 1e-3
epochs &#x3D; 20
optimizer &#x3D; torch.optim.Adam(net.parameters(), lr&#x3D;lr)
criterion &#x3D; nn.CrossEntropyLoss()
scheduler &#x3D; torch.optim.lr_scheduler.ReduceLROnPlateau(optimizer, &#39;min&#39;, factor&#x3D;0.5, verbose&#x3D;True, patience&#x3D;5, min_lr&#x3D;0.0000001)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">train_loss &#x3D; []
train_acc &#x3D; []
val_loss &#x3D; []
val_acc &#x3D; []

for epoch in tqdm(range(epochs)):
    train_losses &#x3D; 0
    train_acces &#x3D; 0
    val_losses &#x3D; 0
    val_acces &#x3D; 0
    
    for x, y in train_dataloader:
        x, y &#x3D; x.to(device), y.to(device)
        output &#x3D; net(x)
        # è®¡ç®—loss
        loss &#x3D; criterion(output, y)
        # è®¡ç®—é¢„æµ‹å€¼
        _, pred &#x3D; torch.max(output, axis&#x3D;1)
        # è®¡ç®—acc
        acc &#x3D; torch.sum(y &#x3D;&#x3D; pred) &#x2F; output.shape[0]

        # åå‘ä¼ æ’­
        # æ¢¯åº¦æ¸…é›¶
        optimizer.zero_grad()
        loss.backward()
        optimizer.step()

        train_losses +&#x3D; loss.item()
        train_acces +&#x3D; acc.item()

    train_loss.append(train_losses &#x2F; len(train_dataloader))
    train_acc.append(train_acces &#x2F; len(train_dataloader))

    # æ¨¡å‹è¯„ä¼°
    net.eval()
    with torch.no_grad():
        for x, y in test_dataloader:
            x, y &#x3D; x.to(device), y.to(device)
            output &#x3D; net(x)
            loss &#x3D; criterion(output, y)
            scheduler.step(loss)
            _, pred &#x3D; torch.max(output, axis&#x3D;1)
            acc &#x3D; torch.sum(y &#x3D;&#x3D; pred) &#x2F; output.shape[0]

            val_losses +&#x3D; loss.item()
            val_acces +&#x3D; acc.item()
        
        val_loss.append(val_losses &#x2F; len(test_dataloader))
        val_acc.append(val_acces &#x2F; len(test_dataloader))

    print(f&quot;epoch:&#123;epoch+1&#125;  train_loss:&#123;train_losses &#x2F; len(train_dataloader):.4f&#125;, train_acc:&#123;train_acces &#x2F; len(train_dataloader):.4f&#125;, val_loss:&#123;val_losses &#x2F; len(test_dataloader):.4f&#125;, val_acc:&#123;val_acces &#x2F; len(test_dataloader)&#125;&quot;)

plt.plot(train_loss, color&#x3D;&#39;green&#39;, label&#x3D;&#39;train loss&#39;)
plt.plot(val_loss, color&#x3D;&#39;blue&#39;, label&#x3D;&#39;val loss&#39;)
plt.legend()
plt.xlabel(&quot;epoch&quot;)
plt.ylabel(&quot;loss&quot;)
plt.show()


plt.plot(train_acc, color&#x3D;&#39;green&#39;, label&#x3D;&#39;train acc&#39;)
plt.plot(val_acc, color&#x3D;&#39;blue&#39;, label&#x3D;&#39;val acc&#39;)
plt.legend()
plt.xlabel(&quot;epoch&quot;)
plt.ylabel(&quot;acc&quot;)
plt.show()

PATH &#x3D; &#39;.&#x2F;cw_mnist_lenet1.pth&#39;
torch.save(net, PATH)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-Python" data-language="Python"><code class="language-Python">5%|â–Œ         | 1&#x2F;20 [00:08&lt;02:46,  8.76s&#x2F;it]
epoch:1  train_loss:0.0304, train_acc:0.9907, val_loss:0.0406, val_acc:0.9872
 10%|â–ˆ         | 2&#x2F;20 [00:18&lt;02:50,  9.49s&#x2F;it]
epoch:2  train_loss:0.0301, train_acc:0.9908, val_loss:0.0404, val_acc:0.9872
 15%|â–ˆâ–Œ        | 3&#x2F;20 [00:28&lt;02:44,  9.70s&#x2F;it]
epoch:3  train_loss:0.0300, train_acc:0.9908, val_loss:0.0403, val_acc:0.9872
 20%|â–ˆâ–ˆ        | 4&#x2F;20 [00:37&lt;02:29,  9.37s&#x2F;it]
epoch:4  train_loss:0.0298, train_acc:0.9908, val_loss:0.0401, val_acc:0.9871
 25%|â–ˆâ–ˆâ–Œ       | 5&#x2F;20 [00:48&lt;02:26,  9.79s&#x2F;it]
epoch:5  train_loss:0.0296, train_acc:0.9908, val_loss:0.0399, val_acc:0.9871
 30%|â–ˆâ–ˆâ–ˆ       | 6&#x2F;20 [00:58&lt;02:19,  9.97s&#x2F;it]
epoch:6  train_loss:0.0294, train_acc:0.9909, val_loss:0.0398, val_acc:0.9872
 35%|â–ˆâ–ˆâ–ˆâ–Œ      | 7&#x2F;20 [01:07&lt;02:04,  9.57s&#x2F;it]
epoch:7  train_loss:0.0293, train_acc:0.9910, val_loss:0.0396, val_acc:0.9872
 40%|â–ˆâ–ˆâ–ˆâ–ˆ      | 8&#x2F;20 [01:17&lt;01:57,  9.78s&#x2F;it]
epoch:8  train_loss:0.0291, train_acc:0.9910, val_loss:0.0395, val_acc:0.9872
 45%|â–ˆâ–ˆâ–ˆâ–ˆâ–Œ     | 9&#x2F;20 [01:28&lt;01:50, 10.06s&#x2F;it]
epoch:9  train_loss:0.0290, train_acc:0.9911, val_loss:0.0393, val_acc:0.9872
 50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 10&#x2F;20 [01:36&lt;01:36,  9.68s&#x2F;it]
epoch:10  train_loss:0.0288, train_acc:0.9912, val_loss:0.0392, val_acc:0.9874
 55%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 11&#x2F;20 [01:46&lt;01:27,  9.78s&#x2F;it]
epoch:11  train_loss:0.0287, train_acc:0.9912, val_loss:0.0390, val_acc:0.9874
 60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 12&#x2F;20 [01:57&lt;01:19,  9.94s&#x2F;it]
epoch:12  train_loss:0.0286, train_acc:0.9913, val_loss:0.0389, val_acc:0.9875
 65%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ   | 13&#x2F;20 [02:05&lt;01:07,  9.58s&#x2F;it]
epoch:13  train_loss:0.0285, train_acc:0.9914, val_loss:0.0388, val_acc:0.9876
 70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 14&#x2F;20 [02:16&lt;00:58,  9.80s&#x2F;it]
epoch:14  train_loss:0.0283, train_acc:0.9914, val_loss:0.0387, val_acc:0.9876
 75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 15&#x2F;20 [02:26&lt;00:49, 10.00s&#x2F;it]
epoch:15  train_loss:0.0282, train_acc:0.9915, val_loss:0.0386, val_acc:0.9878
 80%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 16&#x2F;20 [02:37&lt;00:40, 10.09s&#x2F;it]
epoch:16  train_loss:0.0281, train_acc:0.9915, val_loss:0.0384, val_acc:0.9878
 85%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 17&#x2F;20 [02:47&lt;00:30, 10.21s&#x2F;it]
epoch:17  train_loss:0.0280, train_acc:0.9915, val_loss:0.0383, val_acc:0.9878
 90%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ | 18&#x2F;20 [02:56&lt;00:19,  9.75s&#x2F;it]
epoch:18  train_loss:0.0279, train_acc:0.9916, val_loss:0.0382, val_acc:0.988
 95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 19&#x2F;20 [03:06&lt;00:09,  9.93s&#x2F;it]
epoch:19  train_loss:0.0278, train_acc:0.9916, val_loss:0.0381, val_acc:0.988
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 20&#x2F;20 [03:16&lt;00:00,  9.84s&#x2F;it]
epoch:20  train_loss:0.0277, train_acc:0.9917, val_loss:0.0380, val_acc:0.988<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<img src="/posts/ffb6a1cc/1.png" class loading="lazy">

<img src="/posts/ffb6a1cc/2.png" class loading="lazy">

<p>è¿™é‡Œæ²¡æœ‰æ”¹å˜å‚æ•°ï¼Œåªæ˜¯å¯¹ä¸€ä¸ªå‚æ•°è¿›è¡Œäº†æµ‹è¯•</p>
<pre class="line-numbers language-Python" data-language="Python"><code class="language-Python"># ç”¨äºå¯è§†åŒ–
adv_examples &#x3D; []
correct &#x3D; 0
vis_max &#x3D; 10
vis_num &#x3D; 0
rand_num &#x3D; -1

for data, label in  test_dataloader:
    data, label &#x3D; data.to(device), label.to(device)
    attack_data &#x3D; cw_l2_attack(model&#x3D;net, images&#x3D;data, labels&#x3D;label)
    output &#x3D; net(attack_data)
    _, pred &#x3D; torch.max(output, axis&#x3D;1)
    # print(label)
    # print(pred)
    # print(sum(pred &#x3D;&#x3D; label))
    # ç»Ÿè®¡ä¸€ä¸‹æ”»å‡»ä»¥åæ­£ç¡®çš„æ•°é‡
    correct +&#x3D; torch.sum(pred &#x3D;&#x3D; label)
    rand_num &#x3D; torch.randint(0, 11, (1,))
    if rand_num % 2 &#x3D;&#x3D; 0 and vis_num &lt; vis_max:
        adv_examples.append((data, label, attack_data, pred))
        vis_num +&#x3D; 1

print(&quot;Attack accuracy:&quot;, float(correct) &#x2F; len(test_dataset))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¯è§†åŒ–ç”Ÿæˆçš„å¯¹æŠ—æ ·æœ¬</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
index <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment"># å½“å‰è¡Œç”»çš„å›¾ç‰‡</span>
current <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment"># è®¾ç½®å½“å‰è¡Œç”»åŸå§‹è¿˜æ˜¯æ”»å‡»</span>
odd <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>adv_examples<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data<span class="token punctuation">,</span> label<span class="token punctuation">,</span> attack_data<span class="token punctuation">,</span> pred <span class="token operator">=</span> adv_examples<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    current <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>adv_examples<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># ä¸€ä¸ªæ‰¹æ¬¡çš„æ•°æ®åªç”»5å¼ </span>
        <span class="token keyword">if</span> label<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">!=</span> pred<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token keyword">and</span> current <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">:</span>
            index <span class="token operator">+=</span> <span class="token number">1</span>
            current <span class="token operator">+=</span> <span class="token number">1</span>
            plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>adv_examples<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span>
            <span class="token keyword">if</span> current <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">and</span> odd <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"original image"</span><span class="token punctuation">)</span>            
            <span class="token keyword">elif</span> current <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">and</span> odd <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"attack image"</span><span class="token punctuation">)</span>
                
            <span class="token keyword">if</span> odd <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"&#123;&#125; --> &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>label<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> pred<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>attack_data<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"&#123;&#125; --> &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>label<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> label<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>data<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    odd <span class="token operator">+=</span> <span class="token number">1</span>

    plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç¯‡æ–‡ç« ä¸­çš„å¯è§†åŒ–ï¼Œæˆ‘å°è¯•äº†batch_sizeä¸ä¸º1ï¼Œè€Œæ˜¯64ï¼Œå’Œå‰å‡ ç¯‡æ–‡ç« æˆªç„¶ä¸åŒã€‚</p>
<img src="/posts/ffb6a1cc/3.png" class loading="lazy">

<h4 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h4><p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1684098">ç‹¬å®¶è§£è¯» | åŸºäºä¼˜åŒ–çš„å¯¹æŠ—æ”»å‡»ï¼šCWæ”»å‡»çš„åŸç†è¯¦è§£ä¸ä»£ç è§£è¯»-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://muyuuuu.github.io/2021/05/04/CW-attack/">å¯¹æŠ—æ”»å‡»ç¯‡ï¼šCW æ”»å‡»ç®—æ³• | Just for Life. (muyuuuu.github.io)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_41466575/article/details/117738731">å¯¹æŠ—æ ·æœ¬ä¹‹CWåŸç†&amp;coding_cwå¯¹æŠ—æ ·æœ¬-CSDNåšå®¢</a>ï¼ˆå¯¹CWç®—æ³•çš„æ‰‹ç¨¿ç†è§£ï¼Œå¾ˆæ¸…æ™°ï¼ï¼ï¼ï¼‰</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/tangweijqxx/p/10627360.html">5.åŸºäºä¼˜åŒ–çš„æ”»å‡»â€”â€”CW - æœºå™¨å­¦ä¹ å®‰å…¨å°ç™½ - åšå®¢å›­ (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_55368674/article/details/130242588">CWå¯¹æŠ—æ ·æœ¬ç”Ÿæˆç®—æ³• torchå®ç°_cwå¯¹æŠ—æ ·æœ¬ç”Ÿæˆæ–¹æ³•æ˜¯ifgsmå—-CSDNåšå®¢</a>ï¼ˆå¯¹ç½®ä¿¡åº¦kçš„ä¸¾ä¾‹è§£é‡Šï¼‰</p>
</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="æ‰“èµ" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><span class="icon iconify" data-icon="ri:hand-coin-line"></span></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a href="/images/Wechat_pay.png"><img loading="lazy" src="/images/Wechat_pay.png" alt="å¾®ä¿¡æ”¯ä»˜" title="å¾®ä¿¡æ”¯ä»˜"></a><div><span style="color:#2DC100"><span class="icon iconify" data-icon="ri:wechat-pay-line"></span></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>æœ¬æ–‡ä½œè€…ï¼š</strong>é­ç¬™è‘­</li><li class="post-copyright-link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="http://lengnian.github.io/posts/ffb6a1cc/" title="å¯¹æŠ—æ”»å‡»:CWç®—æ³•">http://lengnian.github.io/posts/ffb6a1cc/</a></li><li class="post-copyright-license"><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é»˜è®¤é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> è®¸å¯åè®®ã€‚</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/posts/9069b95a/" rel="prev" title="GANå¯¹æŠ—ç½‘ç»œåŸç†ä¸ä»£ç å®ç°"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">GANå¯¹æŠ—ç½‘ç»œåŸç†ä¸ä»£ç å®ç°</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/posts/a1b31fc5/" rel="next" title="å¯¹æŠ—æ”»å‡»:PGDç®—æ³•"><span class="post-nav-text">å¯¹æŠ—æ”»å‡»:PGDç®—æ³•</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>è‹¥æ‚¨æƒ³åŠæ—¶å¾—åˆ°å›å¤æé†’,å»ºè®®å‘é€é‚®ä»¶(é‚®ç®±åœ¨About meä¸­å¯ä»¥æ‰¾åˆ°)ã€‚</span><br></div><style>.utterances {
  max-width: 100%;
}</style><script src="https://utteranc.es/client.js" repo="LengNian/Blog-comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; CopyRight 2023 â€“ 2025 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> é­ç¬™è‘­</span></div><div class="powered"><span>ç”± <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> é©±åŠ¨ v7.3.0</span><span class="footer-separator">|</span><span>ä¸»é¢˜ - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div><div class="live-time"><span>æ„Ÿè°¢é™ªä¼´</span><span id="display_live_time"></span><span class="moe-text">(â—'â—¡'â—)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2024-07-22T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = ` ${passDay} å¤© ${passHour} å°æ—¶ ${passMinute} åˆ† ${passSecond} ç§’`;
}
blog_live_time();
</script></div><div id="busuanzi"><span id="busuanzi_container_site_uv" title="æ€»è®¿å®¢é‡"><span><span class="icon iconify" data-icon="ri:user-line"></span></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="æ€»è®¿é—®é‡"><span><span class="icon iconify" data-icon="ri:eye-line"></span></span><span id="busuanzi_value_site_pv"></span></span><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div class="footer-custom-text">Edited by é­ç¬™è‘­</div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="æœç´¢"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:search-line"></span></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="https://fastly.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js"></script><script src="/js/search/local-search.js" defer type="module"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><span class="icon iconify" data-icon="ri:close-line"></span></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="æœç´¢..." value=""></div><div class="search-result-container"></div></div><script>function initMourn() {
  const date = new Date();
  const today = (date.getMonth() + 1) + "-" + date.getDate()
  const mourn_days = ["4-4","9-18","12-13"]
  if (mourn_days.includes(today)) {
    document.documentElement.style.filter = "grayscale(1)";
  }
}
initMourn();</script><div class="aplayer no-destroy" id="aplayer" data-id="4867800677" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay data-theme="#ad7a86" data-loop="all" data-order="random" data-preload="auto" data-volume="0.7" data-mutex data-lrctype="0" data-listfolded data-listmaxheight="340px" data-storagename="metingjs"></div><script src="https://fastly.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script>const images = [...document.querySelectorAll('.markdown-body img')]
mediumZoom(images)</script><style>.medium-zoom-image {
  z-index: 99;
}</style><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":200,"height":400,"hOffset":-30,"vOffset":-20},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>